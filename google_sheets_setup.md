# 구글 시트 연동 설정 가이드

볼링 팀짜기 프로그램에서 구글 시트를 연동하여 선수 데이터를 가져오는 방법을 설명합니다.

## 1. 필요한 라이브러리 설치

```bash
pip install -r requirements.txt
```

## 2. 구글 클라우드 프로젝트 설정

### 2.1. Google Cloud Console 접속

1. [Google Cloud Console](https://console.cloud.google.com/)에 접속
2. 새 프로젝트 생성 또는 기존 프로젝트 선택

### 2.2. Google Sheets API 활성화

1. "API 및 서비스" > "라이브러리" 메뉴로 이동
2. "Google Sheets API" 검색 후 활성화
3. "Google Drive API"도 함께 활성화

### 2.3. 서비스 계정 생성

1. "API 및 서비스" > "사용자 인증 정보" 메뉴로 이동
2. "사용자 인증 정보 만들기" > "서비스 계정" 선택
3. 서비스 계정 이름 입력 (예: "bowling-team-maker")
4. "키 만들기" > "JSON" 선택하여 키 파일 다운로드

## 3. 구글 시트 설정

### 3.1. 시트 생성

1. [Google Sheets](https://sheets.google.com/)에서 새 시트 생성
2. 첫 번째 행에 헤더 입력 (A열, B열은 자유롭게 사용 가능)
3. **C열**: 회원 목록 (선수 이름)
4. **D열**: 평균점수 (에버)
5. **55줄 기준**: 55줄 이하는 하반기 점수, 55줄 초과는 상반기 점수

### 3.2. 권한 설정

1. 다운로드한 JSON 키 파일의 `client_email` 값을 복사
2. 구글 시트에서 "공유" 버튼 클릭
3. 복사한 이메일 주소를 편집자 권한으로 추가

## 4. 프로그램에서 사용

### 4.1. 인증 파일 설정

1. 프로그램의 "구글 시트 연동" 섹션에서 "찾아보기" 버튼 클릭
2. 다운로드한 JSON 키 파일 선택

### 4.2. 시트 정보 입력

1. **시트 URL**: 구글 시트의 URL 복사하여 입력
   - 예: `https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit`
2. **시트 이름**: 데이터가 있는 시트 이름 입력 (기본값: "Sheet1")

### 4.3. 데이터 가져오기

1. "시트에서 데이터 가져오기" 버튼 클릭
2. 미리보기에서 원하는 선수들을 선택
3. "선택된 선수 추가" 버튼으로 등록

## 5. 시트 데이터 형식

### 5.1. 필수 형식

- **C열**: 회원 목록 (선수 이름)
- **D열**: 평균점수 (에버)
- **AC열**: 성별 정보 (여성: 여, 여성, f, female, 여자 / 남성: 기타)
- **첫 번째 행**: 헤더 (프로그램에서 무시됨)
- **55줄 기준**:
  - 55줄 이하: 상반기 점수
  - 55줄 초과: 하반기 점수 (우선 사용)

### 5.2. 점수 우선순위

프로그램은 다음과 같은 우선순위로 점수를 가져옵니다:

1. **하반기 점수 우선**: 55줄 초과에 있는 점수가 있으면 해당 점수 사용
2. **상반기 점수 보조**: 하반기 점수가 없고 상반기 점수만 있으면 상반기 점수 사용

### 5.3. 성별 고려 팀짜기

프로그램은 성별 정보를 고려하여 팀을 구성합니다:

- **여성 선수 우선 분배**: 여성 선수들을 먼저 팀별로 고르게 분배
- **남성 선수 후속 분배**: 남성 선수들을 나머지 자리에 분배
- **밸런싱 최적화**: 에버 점수와 성별 분포를 모두 고려하여 최적화

### 5.4. 예시 데이터

```
A열    | B열    | C열(회원목록) | D열(평균점수) | ... | AC열(성별)
기타   | 기타   | 박영오        | 207          | ... | 남
기타   | 기타   | 하영훈        | 198          | ... | 여
기타   | 기타   | 허서호        | 192          | ... | 남
...
(55줄까지: 상반기 점수)
...
(56줄부터: 하반기 점수)
```

## 6. 주의사항

- JSON 키 파일은 보안상 안전한 곳에 보관하세요
- 시트 URL은 공개 링크가 아니어도 됩니다 (서비스 계정이 접근 권한만 있으면 됨)
- 평균점수는 숫자 형식이어야 합니다
- 빈 행이나 잘못된 형식의 데이터는 자동으로 무시됩니다
- 같은 선수의 하반기와 상반기 점수가 모두 있는 경우, 하반기 점수가 우선적으로 사용됩니다

## 7. 문제 해결

### 7.1. "권한 오류" 발생 시

- 서비스 계정 이메일이 시트에 편집자 권한으로 추가되었는지 확인
- JSON 키 파일이 올바른지 확인

### 7.2. "API 할당량 초과" 발생 시

- Google Cloud Console에서 할당량 확인
- 필요시 할당량 증가 요청

### 7.3. "시트를 찾을 수 없음" 오류

- 시트 URL이 올바른지 확인
- 시트 이름이 정확한지 확인

### 7.4. 데이터가 제대로 불러와지지 않는 경우

- C열과 D열에 데이터가 올바르게 입력되었는지 확인
- 55줄 기준으로 하반기/상반기 점수가 올바르게 구분되었는지 확인
